<!DOCTYPE html>
<html id="plot">

<head>
    <title>Plot App</title>
    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="../../chaise/styles/vendor/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../../chaise/common/styles/app.css">
    <link rel="stylesheet" type="text/css" href="../../chaise/common/styles/appheader.css">
    <link rel="stylesheet" type="text/css" href="styles/plot.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- vendor dependencies -->
    <!-- TODO: change to dynamicly load assets -->
    <script src="../../chaise/scripts/vendor/jquery-3.4.1.min.js"></script>
    <script src="../../chaise/scripts/vendor/angular.js"></script>
    <!-- TODO: This shouldn't be "latest", maybe rename so it doesn't imply the current master vsion from plotly.js -->
    <script src="../../chaise/scripts/vendor/plotly-latest.min.js"></script>
    <script src="../../chaise/dist/chaise.vendor.min.js"></script>

    <!-- chaise dependencies -->
    <script src="../../chaise/chaise-config.js"></script>
    <script src="../../chaise/dist/chaise.min.js"></script>

    <!-- plot dependencies -->
    <script src="plot-config.js"></script>
    <script src="plot.app.js"></script>

    <!-- ermrestJS dependecnies -->
    <script src="../../ermrestjs/ermrest.min.js"></script>

</head>

<body class="chaise-body">
    <div class="configure-container" ng-app="chaise.configure-plotApp"></div>
    <div class="app-container">
        <navbar></navbar>
        <div ng-controller="plotController as ctrl" id="appDiv">
            <div ng-if= "ctrl.model.title" class="row">
                <div id="bookmark-container" class="col-xs-12 meta-icons">
                    <div id="title" class="pull-left">
                        <h1 id="page-title"><span>{{ctrl.model.title}}</span></h1>
                    </div>
                </div>
            </div>
            <div id="main-content" class="plot-container">
                <div class="main-container">
                    <div class="main-body">
                        <div class="alerts-container">
                            <alerts alerts="ctrl.alerts"></alerts>
                        </div>
                        <!-- <div class="col-sm-3">  TODO: UI : selection for different types of plot types.
                            <div class="sub-header">Plot type</div>
                            <div>
                                <select ng-model="ctrl.model.type.name" ng-options="s for s in ctrl.types"
                                ng-change="::ctrl.changeSelection()"></select>
                            </div>
                        </div> -->

                        <div id="plotSpinner" ng-show="!plotsLoaded">
                            <img src="styles/images/loader.gif" class="spinner" />
                            <div style="margin-top: 15px;">Loading...</div>
                        </div>
                        <div ng-show="plotsLoaded" class="plots-wrapper" ng-repeat="plot in plots">
                            <div ng-if="ctrl.showViolinControls(plot.plot_type)" class="violin-controls">
                                <!-- modal popup input -->
                                <div class="chaise-input-group modal-popup gene-selector-group">
                                    <div class="input-label">Gene:</div>
                                    <div class="chaise-input-control has-feedback">
                                        <div contenteditable="false" class="popup-select-value" style="cursor: pointer" ng-click="ctrl.openGeneSelector()" ng-bind-html="gene.displayname.value"></div>
                                    </div>
                                    <label class="sr-only"></label>
                                    <!-- So that the foreign key input can be validated -->
                                    <input type="hidden" ng-model="geneId" />
                                    <span class="chaise-input-group-append">
                                        <button ng-focus="::form.blurElement($event);" class="chaise-btn chaise-btn-primary modal-popup-btn" type="button" ng-click="ctrl.openGeneSelector()" tooltip-placement="right" uib-tooltip="Choose a gene.">
                                            <span class="glyphicon glyphicon-chevron-down"></span>
                                        </button>
                                    </span>
                                </div>
                                <div class="group-by-dropdown">
                                    <div class="group-by-text input-label">Group By:</div>
                                    <div class="chaise-input-group" uib-dropdown >
                                        <div class="chaise-input-control" uib-dropdown-toggle>
                                            <div contenteditable="false" style="cursor: pointer" ng-bind-html="groupKey"></div>
                                            <button class="chaise-btn chaise-btn-primary" type="button">
                                                <span class="glyphicon glyphicon-chevron-down"></span>
                                            </button>
                                        </div>
                                        <ul uib-dropdown-menu role="menu">
                                            <li ng-repeat="group in ctrl.groups" ng-click="ctrl.setGroup(group)">
                                                <a ng-bind-html="group"></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                                <div class="toggle-scale-dropdown">
                                    <div class="toggle-scale-text input-label">Scale:</div>
                                    <div class="chaise-input-group" uib-dropdown >
                                        <div class="chaise-input-control" uib-dropdown-toggle>
                                            <div contenteditable="false" style="cursor: pointer" ng-bind-html="yAxisScale"></div>
                                            <button class="chaise-btn chaise-btn-primary" type="button">
                                                <span class="glyphicon glyphicon-chevron-down"></span>
                                            </button>
                                        </div>
                                        <ul uib-dropdown-menu role="menu">
                                            <li ng-repeat="scale in ctrl.scales" ng-click="ctrl.toggleScale(scale)">
                                                <a ng-bind-html="scale"></a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <div class="plot">
                                <plot plot-id="{{plot.id}}"></plot>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
</html>
